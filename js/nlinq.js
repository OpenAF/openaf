/*v:0.1.6;a:Nuno Aguiar;Copyright 2025 Nuno Aguiar;*/
var nLinq_USE_CASE=!1,nLinq=function(h,l){$$(h).isMap()&&(l=_$(l,"aKey").isString().default("_key"),h=Object.keys(h).map(a=>{$$(h[a]).isMap()&&(h[a][l]=a);return h[a]}));var f=h,m="",d=nLinq_USE_CASE,g=!1,p=!1,t=0,y=0,C=!1,w=[],D=0,H=function(a,b){if(null===a||void 0===a||null===b||void 0===b)return a===b;if(a.constructor!==b.constructor)return!1;if(a instanceof Function||a instanceof RegExp)return a===b;if(a===b||a.valueOf()===b.valueOf())return!0;if(Array.isArray(a)&&a.length!==b.length||a instanceof
    Date||!(a instanceof Object)||!(b instanceof Object))return!1;var e=Object.keys(a),k=Object.keys(b);if(e.length!=k.length)return!1;for(var n in a)if(e=a[n],$$(b[n]).isUnDef()||!H(e,b[n]))return!1;return!0},J=function(a,b,e){_$(a).isArray().$_();var k,n=!1;for(k=0;k<a.length&&!n;k++){var r=$$(e).isFunction()?e(a[k]):a[k];H(b,r)&&(n=!0)}return n?k-1:-1},A=function(a){if(!$$(a).isMap())return a;var b={};Object.keys(a).sort().forEach(e=>{b[e]=$$(a[e]).isMap()?A(a[e]):a[e]});return b},K=function(a,b){var e=
    b.map(k=>JSON.stringify(A(k),void 0,""));return a.filter(k=>0>e.indexOf(JSON.stringify(A(k),void 0,"")))},L=function(a,b){var e=b.map(k=>JSON.stringify(A(k),void 0,""));return a.filter(k=>0<=e.indexOf(JSON.stringify(A(k),void 0,"")))},M=function(a,b){var e=a.map(k=>JSON.stringify(A(k),void 0,""));return a.concat(b.filter(k=>0>e.indexOf(JSON.stringify(A(k),void 0,""))))},N=function(a,b){return a.map(e=>b.map(k=>isMap(k)?merge(e,k):[e,k])).reduce((e,k)=>e.concat(k))},v=(a,b,e)=>{$$(a).isFunction()&&
    (a=a());$$(a).isArray()||(a=[a]);if(!$$(a).isUnDef()){if(0<D)if(e)for(e=0;e<D;e++)m+=")";else return a;if(0==m.length){if(C)return[];0!=y&&(a=a.slice(y));return 0!=t?a.slice(0>t?t:0,0<t?t:void 0):a}m=m.replace(/;/g," ");var k=$$(b).isFunction()?b:new Function("r","whereFn","return $$(r).isDef() ? ("+m+") : void 0");f=0!=t?C?a.filter(n=>!k(n,w)).slice(0>t?t:0,0<t?t:void 0):a.filter(n=>k(n,w)).slice(0>t?t:0,0<t?t:void 0):C?a.filter(n=>!k(n,w)):a.filter(n=>k(n,w));0!=y&&(f=f.slice(y));return f}},O=a=>
    {if($$(a).isString()&&a.replace(/^[^a-zA-Z_$]|[^\w\[\]\.$]/g,"")==a)return a;if($$(a).isDef())throw"'"+a+"' is not a valid key.";},F=a=>{$$(a).isNumber()||$$(a).isBoolean()||($$(a).isString()&&(a=d?a:a.toLowerCase()),a=JSON.stringify(a,void 0,""));return a},P=a=>{var b=(k,n,r)=>{var u=Object.keys(k);_$(n,"aFunc").isFunction().$_();r=_$(r).isString().default("");for(var x in u)$$(k[u[x]]).isMap()||$$(k[u[x]]).isArray()?b(k[u[x]],n,(""==r?"":r+".")+u[x]):n(u[x],k[u[x]],r,k)},e={};b(a,(k,n,r,u)=>{e[r+
    (""==r?"":".")+k]=n});return e},q=(a,b,e,k,n,r)=>{if($$(r).isUnDef()&&$$(a).isMap()){var u=P(a);Object.keys(u).forEach(z=>{q(z,u[z],e,k)})}else{var x=!0;if(n){n=$$(r).isDef();var B=b;b=F(n?b:a);r=F(n?r:B)}else{n=$$(b).isDef();b=F(n?b:a);try{a=n?O(a):void 0}catch(z){if(0<String(z).indexOf("is not a valid key"))x=!1;else throw z;}}0<=e.indexOf("{ki}")&&(e=e.replace(/{ki}/g,$$(b).isString()&&!d?".toLowerCase()":""));0<=e.indexOf("{ski}")&&(e=e.replace(/{ski}/g,$$(b).isString()&&!d?"String(":""));0<=
    e.indexOf("{eki}")&&(e=e.replace(/{eki}/g,$$(b).isString()&&!d?").toLowerCase()":""));e=n?e.replace(/{k}/g,x?"r."+a:"$$$$(r).get("+JSON.stringify(a)+")"):e.replace(/{k}/g,"r");$$(b).isString()&&(b=b.replace(/\$/g,"$$$"));$$(r).isDef()?($$(r).isString()&&(r=r.replace(/\$/g,"$$$")),r=F(r),e=e.replace(/{v}/g,b).replace(/{v2}/g,r)):e=e.replace(/{v}/g,b);E(e,k)}},E=(a,b)=>{b=_$(b).default(g);0<m.trim().length&&!m.trim().endsWith("(")&&(m=b?"("+m+") || ":m+" && ");m+="("+a+")"},c={_setState:a=>{_$(a,"map").isMap().$_();
    m=a.where;d=a.useCase;g=a.useOr;p=a.useNot;t=a.alimit;y=a.askip;C=a.negative;w=a.whereFn;return c},_getState:()=>({where:m,useCase:d,useOr:g,useNot:p,alimit:t,askip:y,negative:C,whereFn:w}),useCase:a=>{d=$$(a).isUnDef()||a?!0:!1;return c},ignoreCase:a=>{d=$$(a).isUnDef()||a?!1:!0;return c},limit:a=>{$$(a).isNumber()&&(t=a);return c},head:a=>{c.limit(a);return c},tail:a=>{$$(a).isNumber()&&(t=-a);return c},or:()=>{g=!0;return c},and:()=>{g=!1;return c},not:()=>{p=!0;return c},andNot:()=>{g=!1;p=!0;
    return c},orNot:()=>{p=g=!0;return c},setWhere:a=>{E(a,!1);return c},where:a=>{g?p?c.orNotWhere(a):c.orWhere(a):p?c.andNotWhere(a):c.andWhere(a);return c},orWhere:a=>{_$(a,"fn").isFunction().$_();w.push(a);E("whereFn["+(w.length-1)+"](r)",!0);return c},andWhere:a=>{_$(a,"fn").isFunction().$_();w.push(a);E("whereFn["+(w.length-1)+"](r)",!1);return c},notWhere:a=>{g?c.orNotWhere(a):c.andNotWhere(a);return c},andNotWhere:a=>{_$(a,"fn").isFunction().$_();w.push(a);E("!whereFn["+(w.length-1)+"](r)",!1);
    return c},orNotWhere:a=>{_$(a,"fn").isFunction().$_();w.push(a);E("!whereFn["+(w.length-1)+"](r)",!0);return c},begin:()=>{m+=(0<m.trim().length&&!m.trim().endsWith("(")?" && ":"")+"(";D++;return c},orBegin:()=>{m+=(0<m.trim().length&&!m.trim().endsWith("(")?" || ":"")+"(";D++;return c},andBegin:()=>c.begin(),end:()=>{0<D&&(m+=")",D--);return c},starts:(a,b)=>{g?p?c.orNotStarts(a,b):c.orStarts(a,b):p?c.andNotStarts(a,b):c.andStarts(a,b);return c},ends:(a,b)=>{g?p?c.orNotEnds(a,b):c.orEnds(a,b):p?
    c.andNotEnds(a,b):c.andEnds(a,b);return c},equals:(a,b)=>{g?p?c.orNotEquals(a,b):c.orEquals(a,b):p?c.andNotEquals(a,b):c.andEquals(a,b);return c},greater:(a,b)=>{g?p?c.orNotGreater(a,b):c.orGreater(a,b):p?c.andNotGreater(a,b):c.andGreater(a,b);return c},less:(a,b)=>{g?p?c.orNotLess(a,b):c.orLess(a,b):p?c.andNotLess(a,b):c.andLess(a,b);return c},greaterEquals:(a,b)=>{g?p?c.orNotGreaterEquals(a,b):c.orGreaterEquals(a,b):p?c.andNotGreaterEquals(a,b):c.andGreaterEquals(a,b);return c},lessEquals:(a,b)=>
    {g?p?c.orNotLessEquals(a,b):c.orLessEquals(a,b):p?c.andNotLessEquals(a,b):c.andLessEquals(a,b);return c},contains:(a,b)=>{g?p?c.orNotContains(a,b):c.orContains(a,b):p?c.andNotContains(a,b):c.andContains(a,b);return c},empty:(a,b)=>{g?p?c.orNotEmpty(a,b):c.orEmpty(a,b):p?c.andNotEmpty(a,b):c.andEmpty(a,b);return c},match:(a,b)=>{g?p?c.orNotMatch(a,b):c.orMatch(a,b):p?c.andNotMatch(a,b):c.andMatch(a,b);return c},type:(a,b)=>{g?p?c.orNotType(a,b):c.orType(a,b):p?c.andNotType(a,b):c.andType(a,b);return c},
    between:(a,b,e)=>{g?p?c.orNotBetween(a,b,e):c.orBetween(a,b,e):p?c.andNotBetween(a,b,e):c.andBetween(a,b,e);return c},betweenEquals:(a,b,e)=>{g?p?c.orNotBetweenEquals(a,b,e):c.orBetweenEquals(a,b,e):p?c.andNotBetweenEquals(a,b,e):c.andBetweenEquals(a,b,e);return c},is:a=>{g?p?c.orNotIs(a):c.orIs(a):p?c.andNotIs(a):c.andIs(a);return c},andStarts:(a,b)=>{q(a,b,"String({k}){ki}.startsWith({v})",!1);return c},andEnds:(a,b)=>{q(a,b,"String({k}){ki}.endsWith({v})",!1);return c},andEquals:(a,b)=>{q(a,b,
    "{ski}{k}{eki} == {v}",!1);return c},andGreater:(a,b)=>{q(a,b,"{ski}{k}{eki} > {v}",!1);return c},andLess:(a,b)=>{q(a,b,"{ski}{k}{eki} < {v}",!1);return c},andGreaterEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} >= {v}",!1);return c},andLessEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} <= {v}",!1);return c},andContains:(a,b)=>{q(a,b,"String({k}){ki}.indexOf({v}) >= 0",!1);return c},andEmpty:(a,b)=>{q(a,"","($$({k}).isUnDef() || String({k}){ki}.length == 0)",!1);return c},andMatch:(a,b)=>{q(a,b,"String({k}){ki}.match({v})",
    !1);return c},andType:(a,b)=>{q(a,b,"typeof {k} == {v}",!1);return c},andBetween:(a,b,e)=>{q(a,b,"({ski}{k}{eki} > {v} && {ski}{k}{eki} < {v2})",!1,!0,e);return c},andBetweenEquals:(a,b,e)=>{q(a,b,"({ski}{k}{eki} >= {v} && {ski}{k}{eki} <= {v2})",!1,!0,e);return c},andIs:a=>{q(a,"","{k} != null && {k}",!1);return c},notStarts:(a,b)=>{g?c.orNotStarts(a,b):c.andNotStarts(a,b);return c},notEnds:(a,b)=>{g?c.orNotEnds(a,b):c.andNotEnds(a,b);return c},notEquals:(a,b)=>{g?c.orNotEquals(a,b):c.andNotEquals(a,
    b);return c},notGreater:(a,b)=>{g?c.orNotGreater(a,b):c.andNotGreater(a,b);return c},notLess:(a,b)=>{g?c.orNotLess(a,b):c.andNotLess(a,b);return c},notGreaterEquals:(a,b)=>{g?c.orNotGreaterEquals(a,b):c.andNotGreaterEquals(a,b);return c},notLessEquals:(a,b)=>{g?c.orNotLessEquals(a,b):c.andNotLessEquals(a,b);return c},notContains:(a,b)=>{g?c.orNotContains(a,b):c.andNotContains(a,b);return c},notEmpty:(a,b)=>{g?c.orNotEmpty(a,b):c.andNotEmpty(a,b);return c},notMatch:(a,b)=>{g?c.orNotMatch(a,b):c.andNotMatch(a,
    b);return c},notType:(a,b)=>{g?c.orNotType(a,b):c.andNotType(a,b);return c},notBetween:(a,b,e)=>{g?c.orNotBetween(a,b,e):c.andNotBetween(a,b,e);return c},notBetweenEquals:(a,b,e)=>{g?c.orNotBetweenEquals(a,b,e):c.andNotBetweenEquals(a,b,e);return c},notIs:a=>{g?c.orNotIs(a):c.andNotIs(a);return c},andNotStarts:(a,b)=>{q(a,b,"!(String({k}){ki}.startsWith({v}))",!1);return c},andNotEnds:(a,b)=>{q(a,b,"!(String({k}){ki}.endsWith({v}))",!1);return c},andNotEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} != {v}",
    !1);return c},andNotGreater:(a,b)=>{q(a,b,"{ski}{k}{eki} <= {v}",!1);return c},andNotLess:(a,b)=>{q(a,b,"{ski}{k}{eki} >= {v}",!1);return c},andNotGreaterEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} < {v}",!1);return c},andNotLessEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} > {v}",!1);return c},andNotContains:(a,b)=>{q(a,b,"String({k}){ki}.indexOf({v}) < 0",!1);return c},andNotEmpty:(a,b)=>{q(a,"","($$({k}).isDef() && String({k}){ki}.length != 0)",!1);return c},andNotMatch:(a,b)=>{q(a,b,"!(String({k}){ki}.match({v}))",
    !1);return c},andNotType:(a,b)=>{q(a,b,"typeof {k} != {v}",!1);return c},andNotBetween:(a,b,e)=>{q(a,b,"({ski}{k}{eki} < {v} || {ski}{k}{eki} > {v2})",!1,!0,e);return c},andNotBetweenEquals:(a,b,e)=>{q(a,b,"({ski}{k}{eki} <= {v} || {ski}{k}{eki} >= {v2})",!1,!0,e);return c},andNotIs:a=>{q(a,"","{k} == null || !({k})",!1);return c},orStarts:(a,b)=>{q(a,b,"String({k}){ki}.startsWith({v})",!0);return c},orEnds:(a,b)=>{q(a,b,"String({k}){ki}.endsWith({v})",!0);return c},orEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} == {v}",
    !0);return c},orGreater:(a,b)=>{q(a,b,"{ski}{k}{eki} > {v}",!0);return c},orLess:(a,b)=>{q(a,b,"{ski}{k}{eki} < {v}",!0);return c},orGreaterEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} >= {v}",!0);return c},orLessEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} <= {v}",!0);return c},orContains:(a,b)=>{q(a,b,"String({k}){ki}.indexOf({v}) >= 0",!0);return c},orEmpty:(a,b)=>{q(a,"","($$({k}).isUnDef() || String({k}){ki}.length == 0)",!0);return c},orMatch:(a,b)=>{q(a,b,"String({k}){ki}.match({v})",!0);return c},orType:(a,
    b)=>{q(a,b,"typeof {k} == {v}",!0);return c},orBetween:(a,b,e)=>{q(a,b,"({ski}{k}{eki} > {v} && {ski}{k}{eki} < {v2})",!0,e);return c},orBetweenEquals:(a,b,e)=>{q(a,b,"({ski}{k}{eki} >= {v} && {ski}{k}{eki} <= {v2})",!0,e);return c},orIs:a=>{q(a,"","{k} != null && {k}",!0);return c},orNotStarts:(a,b)=>{q(a,b,"!(String({k}){ki}.startsWith({v}))",!0);return c},orNotEnds:(a,b)=>{q(a,b,"!(String({k}){ki}.endsWith({v}))",!0);return c},orNotEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} != {v}",!0);return c},orNotGreater:(a,
    b)=>{q(a,b,"{ski}{k}{eki} <= {v}",!0);return c},orNotLess:(a,b)=>{q(a,b,"{ski}{k}{eki} >= {v}",!0);return c},orNotGreaterEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} < {v}",!0);return c},orNotLessEquals:(a,b)=>{q(a,b,"{ski}{k}{eki} > {v}",!0);return c},orNotContains:(a,b)=>{q(a,b,"String({k}){ki}.indexOf({v}) < 0",!0);return c},orNotEmpty:(a,b)=>{q(a,"","($$({k}).isDef() && String({k}){ki}.length != 0)",!0);return c},orNotMatch:(a,b)=>{q(a,b,"!(String({k}){ki}.match({v}))",!0);return c},orNotType:(a,b)=>{q(a,
    b,"typeof {k} != {v}",!0);return c},orNotBetween:(a,b,e)=>{q(a,b,"({ski}{k}{eki} < {v} || {ski}{k}{eki} > {v2})",!1,!0,e);return c},orNotBetweenEquals:(a,b,e)=>{q(a,b,"({ski}{k}{eki} <= {v} || {ski}{k}{eki} >= {v2})",!1,!0,e);return c},orNotIs:a=>{q(a,"","{k} == null || !({k})",!0);return c},min:a=>{a=_$(a).isString().default(void 0);var b;c.select(e=>{var k=$$(a).isDef()?Number($$(e).get(a)):Number(e);null!=k&&$$(k).isNumber()&&($$(b).isUnDef()?b=e:($$(a).isDef()&&$$(b).get(a)>k&&(b=e),$$(a).isUnDef()&&
    b>k&&(b=e)))});return b},max:a=>{a=_$(a).isString().default(void 0);var b;c.select(e=>{var k=$$(a).isDef()?Number($$(e).get(a)):Number(e);null!=k&&$$(k).isNumber()&&($$(b).isUnDef()?b=e:($$(a).isDef()&&$$(b).get(a)<k&&(b=e),$$(a).isUnDef()&&b<k&&(b=e)))});return b},average:a=>{a=_$(a).isString().default(void 0);var b=0,e=0;c.select(k=>{k=$$(a).isDef()?Number($$(k).get(a)):Number(k);null!=k&&$$(k).isNumber()&&(e++,b+=k)});return 0<e?b/e:void 0},sum:a=>{a=_$(a).isString().default(void 0);var b=0;c.select(e=>
    {e=$$(a).isDef()?Number($$(e).get(a)):Number(e);null!=e&&$$(e).isNumber()&&(b+=e)});return b},distinct:a=>{a=_$(a).isString().default(void 0);var b=[];c.select(e=>{e=$$(a).isDef()?$$(e).get(a):e;0>b.indexOf(e)&&b.push(e)});return b},group:a=>{a=_$(a).isString().default(void 0);var b={};c.select(e=>{var k=$$(a).isDef()?$$(e).get(a):e;$$(k).isBoolean()&&(k=String(k));0>Object.keys(b).indexOf(k)?b[k]=[e]:b[k].push(e)});return b},groupBy:a=>{a=_$(a).isString().default("key");var b=a.split(",");a={};var e=
    (k,n,r)=>{Object.keys(k).forEach((u,x)=>{r[u]={};n+1<b.length&&e(nLinq(k[u]).group(b[n+1]),n+1,r[u]);b.length==n+1&&(r[u]=k[u])})};return 0<b.length?(e(c.group(b[0]),0,a),a):[]},minBy:(a,b,e,k)=>c.fnBy(a,n=>$$(nLinq(n).min(b)).get(b),_$(e).default("_min"),k),maxBy:(a,b,e,k)=>c.fnBy(a,n=>$$(nLinq(n).max(b)).get(b),_$(e).default("_max"),k),averageBy:(a,b,e,k)=>c.fnBy(a,n=>nLinq(n).average(b),_$(e).default("_avg"),k),sumBy:(a,b,e,k)=>c.fnBy(a,n=>nLinq(n).sum(b),_$(e).default("_sum"),k),countBy:(a,b,
    e)=>c.fnBy(a,k=>nLinq(k).count(),_$(b).default("_count"),e),fnBy:(a,b,e,k)=>{a=_$(a).isString().default("key");b=_$(b).isFunction().default(B=>B.length);e=_$(e).isString().default("_result");k=_$(k).isString().default(a);var n=a.split(","),r=k.split(","),u=[],x=(B,z,G)=>{Object.keys(B).forEach((I,Q)=>{G[r[z]]=I;z+1<n.length&&x(nLinq(B[I]).group(n[z+1]),z+1,G);n.length==z+1&&(G[e]=b(B[I]),u.push(clone(G)))})};return 0<n.length?(x(c.group(n[0]),0,{}),u):[]},at:a=>{_$(a,"index").isNumber().$_();f=v(f,
    __,!0);return f[Number(a)]},all:a=>{f=v(f,__,!0);return $$(f).isArray()?f.length==h.length:a},count:()=>{f=v(f,__,!0);return f.length},first:a=>{f=v(f,__,!0);return 0<f.length?f[0]:a},last:a=>{f=v(f,__,!0);return 0<f.length?f[f.length-1]:a},any:()=>{f=v(f,__,!0);return 0<f.length},none:()=>{f=v(f,__,!0);return 0==f.length},reverse:()=>{f=v(f,__,!0);return f.reverse()},each:a=>{_$(a,"each function").isFunction().$_();c.select(a);return c},intersect:a=>{_$(a,"intersect param").isArray().$_();f=v(f);
    f=L(f,a);return c},except:a=>{_$(a,"except param").isArray().$_();f=v(f);f=K(f,a);return c},union:a=>{_$(a,"union param").isArray().$_();f=v(f);f=M(f,a);return c},cartesian:a=>{_$(a,"cartesian param").isArray().$_();f=v(f);f=N(f,a);return c},attach:(a,b)=>{_$(a,"key").$_();_$(b,"value").$_();f=v(f);f=$$(b).isFunction()?f.map(e=>{$$(e).set(a,b(e));return e}):f.map(e=>{$$(e).set(a,b);return e});return c},attachBy:(a,b,e,k)=>{_$(a,"newkey").isString().$_();_$(b,"key").isString().$_();_$(e,"value").$_();
    _$(k,"class").$_();f=v(f);f=f.map(n=>{e==$$(n).get(b)&&$$(n).set(a,k);return n});return c},detach:a=>{_$(a,"key").$_();f=v(f);f=f.map(b=>{$$(b).unset(a);return b});return c},toDate:a=>{_$(a,"key").$_();f=v(f);f.forEach(b=>{try{var e=$$(b).get(a);($$(e).isString()||$$(e).isNumber())&&$$(b).set(a,new Date(e))}catch(k){}});return c},filter:a=>{_$(a,"value").$_();f=v(f);f=f.filter(b=>{var e=!0;$$(a).isMap()&&$$(b).isMap()&&Object.keys(a).forEach(k=>{H(a[k],b[k])||(e=!1)});$$(b).isArray()&&0>J(b,a)&&(e=
    !1);$$(a).isFunction()&&!a(b)&&(e=!1);($$(a).isNumber()||$$(a).isString())&&($$(b).isNumber()||$$(b).isString())&&b!=a&&(e=!1);return e});return c},sort:function(){var a="";f=v(f);for(var b=0;b<arguments.length;b++){var e=arguments[b],k=!1;e.startsWith("-")&&(k=!0,e=e.substr(1,e.length-1));a=0<a.length?a+" || ":"return ";a=k?a+(' ($$(a).get("'+e+'") > $$(b).get("'+e+'") ? -1 : ($$(a).get("'+e+'") < $$(b).get("'+e+'") ? 1 : 0)) '):a+(' ($$(a).get("'+e+'") > $$(b).get("'+e+'") ? 1 : ($$(a).get("'+e+
    '") < $$(b).get("'+e+'") ? -1 : 0)) ')}f=f.sort(new Function("a","b",a));return c},assign:(a,b,e,k,n)=>{f=v(f);f.forEach(r=>{r[b]=nLinq(a).equals(k,$$(r).get(e)).first(n)});return c},join:(a,b,e,k)=>{f=v(f);f.forEach(n=>{n[b]=nLinq(a).equals(k,$$(n).get(e)).select()});return c},skip:a=>{_$(a).isNumber().$_();y=a;return c},skipWhile:a=>{_$(a,"skip function").isFunction().$_();c.notWhere(a);return c},takeWhile:a=>{_$(a,"take function").isFunction().$_();c.where(a);return c},take:a=>{_$(a).isNumber().$_();
    return c.limit(a)},skipTake:(a,b)=>{_$(a).isNumber().$_();return c.skip(a).take(b)},apply:a=>{a=_$(a,"aMap").isMap().default({});a.where=_$(a.where,"where").isArray().default([]);a.select=_$(a.select,"select").default(void 0);a.transform=_$(a.transform,"transform").isArray().default([]);a.selector=_$(a.selector,"selector").isMap().default(void 0);a.where.forEach(e=>{$$(e.cond).isString()&&(c=c[e.cond].apply(c,e.args))});a.transform.forEach(e=>{$$(e.func).isString()&&(c=c[e.func].apply(c,e.args))});
    var b;$$(a.select).isString()&&(b=c.tselect(new Function("elem","index","array",a.select)));$$(a.select).isMap()&&(b=c.select(a.select));$$(b).isUnDef()&&$$(a.selector).isMap()&&(b=$$(a.selector.func).isString()?$$({}).set(a.selector.func,c[a.selector.func].apply(c,a.selector.args)):b);$$(b).isUnDef()&&$$(a.select).isUnDef()&&(b=c.select());return b},select:a=>{f=v(f,__,!0);if($$(a).isUnDef())return f;if($$(a).isFunction())return f.map(a);if($$(a).isArray()){var b={};a.forEach(k=>{if($$(k).isString())if(0<
    k.indexOf(":")){var n=k.substring(0,k.indexOf(":"));k=k.substring(k.indexOf(":")+1);b[n]=k}else b[k]=k});return f.map(k=>{var n={};Object.keys(b).forEach(r=>$$(n).set(r,$$(k).get(b[r])));return n})}if($$(a).isMap()){var e=Object.keys(a);return f.map(k=>{var n={};e.forEach(r=>{$$($$(k).get(r)).isDef()?$$(n).set(r,$$(k).get(r)):$$(n).set(r,$$(a).get(r))});return n})}},mselect:(a,b,e)=>{a=c.select(a);b=_$(b,"aKey").isString().default("_key");e=_$(e,"dontRemove").isBoolean().default(!0);var k={},n;for(n in a){var r=
    a[n];if($$(b).isDef()&&$$(r[b]).isDef()){var u=r[b];k[u]=r;e||delete k[u][b]}else k["row"+n]=r}return k},define:a=>{f=c.select(a);return c},removed:a=>{C=!0;f=c.select(a);return c},stream:a=>{var b=0<t?t:1;a=c.streamFn(a);do a(),0<t&&b--;while($$(f).isDef()&&0<b)},streamFn:a=>()=>{var b=c.select(a);f=$$(h).isFunction()?h():h;return b},query:a=>{a=_$(a,"aMap").isMap().default({});a.where=_$(a.where,"where").isArray().default([]);a.select=_$(a.select,"select").default(void 0);a.transform=_$(a.transform,
    "transform").isArray().default([]);a.selector=_$(a.selector,"selector").isMap().default(void 0);a.where.forEach(e=>{$$(e.cond).isString()&&(c=c[e.cond].apply(c,e.args))});a.transform.forEach(e=>{$$(e.func).isString()&&(c=c[e.func].apply(c,e.args))});var b;$$(a.select).isString()&&(b=c.tselect(newFn("elem","index","array",a.select)));$$(a.select).isMap()&&(b=c.select(a.select));$$(b).isUnDef()&&$$(a.selector).isMap()&&(b=$$(a.selector.func).isString()?c[a.selector.func].apply(c,a.selector.args):b);
    $$(b).isUnDef()&&$$(a.select).isUnDef()&&(b=c.select());return b}};return c},$from=nLinq;"defined"!=typeof isJavaObject&&(isJavaObject=()=>!1);
    const $$=function(h){return{get:l=>{if($$(h).isObject()){l=l.replace(/\[(\w+)\]/g,".$1");l=l.replace(/^\./,"");l=l.split(".");for(var f=0,m=l.length;f<m;++f){var d=l[f];if(d in h)h=h[d];else return}return h}},getI:l=>{if($$(h).isObject()){l=l.replace(/\[(\w+)\]/g,".$1");l=l.replace(/^\./,"");l=l.split(".");for(var f=0,m=l.length;f<m;++f){var d=l[f];if($$(h).isMap()){var g={};d=String(d).toUpperCase();Object.keys(h).forEach(p=>g[p.toUpperCase()]=p);if(d in g)h=h[g[d]];else return}else if(d in h)h=
    h[d];else return}return h}},set:(l,f)=>{if($$(h).isObject()){var m=h;l=l.replace(/\[(\w+)\]/g,".$1");l=l.replace(/^\./,"");l=l.split(".");for(var d,g,p=0,t=l.length;p<t;++p){var y=l[p];d=h;g=y;y in h||(h[y]={});h=h[y]}d[g]=f;return m}},unset:l=>{if($$(h).isObject()){var f=h;l=l.replace(/\[(\w+)\]/g,".$1");l=l.replace(/^\./,"");l=l.split(".");for(var m,d,g=0,p=l.length;g<p;++g){var t=l[g];m=h;d=t;t in h||(h[t]={});h=h[t]}delete m[d];return f}},isDef:()=>isJavaObject(h)||"undefined"!=typeof h?!0:!1,
    isUnDef:()=>isJavaObject(h)||"undefined"!=typeof h?!1:!0,isJavaObject:()=>isJavaObjecta(h),isArray:()=>Array.isArray(h),isMap:()=>"[object Object]"==Object.prototype.toString.call(h),isObject:()=>{var l=typeof h;return"function"===l||"object"===l&&!!h},isFunction:()=>"function"==typeof h||!1,isString:()=>"string"==typeof h||!1,isNumber:()=>!isNaN(parseFloat(h))&&isFinite(h),isTNumber:()=>"number"==typeof h||!1,isBoolean:()=>"boolean"==typeof h||!1,isNull:()=>null==h||!1,isDate:()=>null!=h&&!isNaN(h)&&
    "undefined"!==typeof h.getDate,isRegExp:()=>h instanceof RegExp,isUUID:()=>h.match(/^\b[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12}\b$/)?!0:!1,isSchema:(l,f)=>{if("undefined"==typeof Ajv)if("undefined"!=typeof loadAjv)loadAjv();else throw"Ajv library not loaded.";ow.loadObj();return ow.obj.schemaValidate(l,h,f)}}},_$=function(h,l){l=$$(l).isDef()?l+" ":"";var f=$$(h).isDef()?!0:!1;const m={default:d=>f?h:d,$_:d=>{$$(d).isUnDef()&&(d=l+"not defined or assigned");if(!f)throw d;return h},
    isNumber:d=>{$$(d).isUnDef()&&(d=l+"is not a number");if(f&&!$$(h).isNumber())throw d;return m},toNumber:d=>{$$(d).isUnDef()&&(d=l+"can't be converted to number");if(f)try{h=Number(h)}catch(g){throw d;}return m},isTNumber:d=>{$$(d).isUnDef()&&(d=l+"is not a number type");if(f&&!$$(h).isTNumber())throw d;return m},isString:d=>{$$(d).isUnDef()&&(d=l+"is not a string");if(f&&!$$(h).isString())throw d;return m},toString:d=>{$$(d).isUnDef()&&(d=l+"can't be converted to string");if(f)try{h=String(h)}catch(g){throw d;
    }return m},isBoolean:d=>{$$(d).isUnDef()&&(d=l+"is not boolean");if(f&&"boolean"!==typeof h)throw d;return m},toBoolean:d=>{$$(d).isUnDef()&&(d=l+"can't be converted to a boolean");if(f)try{$$(h).isNumber()&&(h=!!h),$$(h).isString()&&(h="true"==h.trim().toLowerCase())}catch(g){throw d;}return m},isArray:d=>{$$(d).isUnDef()&&(d=l+"is not an array");if(f&&!$$(h).isArray())throw d;return m},toArray:d=>{$$(d).isUnDef()&&(d=l+"can't be converted to an array");if(f)try{h=String(h).split(",").map(g=>g.trim())}catch(g){throw d;
    }return m},isMap:d=>{$$(d).isUnDef()&&(d=l+"is not a map");if(f&&!$$(h).isMap())throw d;return m},toMap:d=>{$$(d).isUnDef()&&(d=l+"can't be converted to a map");if(f)try{var g=h;h=$$(global.jsonParse).isFunction()?global.jsonParse(g,!0):JSON.parse(g)}catch(p){throw d;}return m},isObject:d=>{$$(d).isUnDef()&&(d=l+"is not an object");if(f&&!$$(h).isObject())throw d;return m},isDate:d=>{$$(d).isUnDef()&&(d=l+"is not a date");if(f&&!$$(h).isDate())throw d;return m},toDate:d=>{$$(d).isUnDef()&&(d=l+"can't be converted to date");
    if(f)try{h=new Date(h)}catch(g){throw d;}return m},isRegExp:d=>{$$(d).isUnDef()&&(d=l+"is not a RegExp");if(f&&!$$(h).isRegExp())throw d;return m},isFunction:d=>{$$(d).isUnDef()&&(d=l+"is not a function");if(f&&!$$(h).isFunction())throw d;return m},isJavaObject:d=>{$$(d).isUnDef()&&(d=l+"is not a java object");if(f&&!isJavaObject(h))throw d;return m},isInstanceOf:(d,g)=>{$$(g).isUnDef()&&(g=l+"is not an instance of "+d);if(f&&!(h instanceof d))throw g;return m},isNotNull:d=>{$$(d).isUnDef()&&(d=l+
    "is null");if(f&&null==h)throw d;return m},isUUID:d=>{$$(d).isUnDef()&&(d=l+"is not an UUID");if(f&&(!$$(h).isString()||h.match(/^\b[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12}\b$/)))throw d;return m},isSchema:(d,g,p)=>{if("undefined"==typeof Ajv)if("undefined"!=typeof loadAjv)loadAjv();else throw"Ajv library not loaded.";ow.loadObj();try{ow.obj.schemaValidate(d,h,p)}catch(t){throw $$(g).isUnDef()&&(g=l+" "+String(t)),g;}return m},check:(d,g)=>{if(!$$(d).isFunction()&&!$$(d).isString())throw"please provide a function to check";
    d=$$(d).isFunction()?d(h):newFn("v","return "+d)(h);$$(g).isUnDef()&&(g=l+"is not ok");if(f&&!d)throw g;return m},expr:(d,g)=>{if(!$$(d).isString())throw"please provide an expression";d=af.eval(templify(d,{v:h}));$$(g).isUnDef()&&(g=l+"is not ok");if(f&&!d)throw g;return m},equals:(d,g)=>{$$(g).isUnDef()&&(g=l+"is equals to "+d);if(f&&h==d)throw g;return m},notEquals:(d,g)=>{$$(g).isUnDef()&&(g=l+"is not equals to "+d);if(f&&h!=d)throw g;return m},anyOf:(d,g)=>{if(!$$(d).isArray())throw"please provide an array of values";
    $$(g).isUnDef()&&(g=l+"has a value not in "+JSON.stringify(d));f&&$$(h).isArray()&&h.forEach(p=>{if(0>d.indexOf(p))throw g;});return m},oneOf:(d,g)=>{if(!$$(d).isArray())throw"please provide an array of values";$$(g).isUnDef()&&(g=l+"is not one of "+JSON.stringify(d));if(f&&!$$(h).isArray()&&0>d.indexOf(h))throw g;return m},between:(d,g,p)=>{$$(p).isUnDef()&&(p=l+"is not between "+d+" and "+g);if(f&&(h>=g||h<=d))throw p;},betweenEquals:(d,g,p)=>{$$(p).isUnDef()&&(p=l+"is not between "+d+" and "+g);
    if(f&&(h>g||h<d))throw p;},less:(d,g)=>{$$(g).isUnDef()&&(g=l+"is less than "+d);if(f&&h>=d)throw g;return m},lessEquals:(d,g)=>{$$(g).isUnDef()&&(g=l+"is less or equals than "+d);if(f&&h>d)throw g;return m},greater:(d,g)=>{$$(g).isUnDef()&&(g=l+"is greater than "+d);if(f&&h<=d)throw g;return m},greaterEquals:(d,g)=>{$$(g).isUnDef()&&(g=l+"is greater or equals than "+d);if(f&&h<d)throw g;return m},notEmpty:d=>{$$(d).isUnDef()&&(d=l+"is empty");if(f&&""==String(h))throw d;return m},empty:d=>{$$(d).isUnDef()&&
    (d=l+"is not empty");if(f&&""!=String(h))throw d;return m},contains:(d,g)=>{if(!$$(d).isString())throw"please provide a string to check if contains";$$(g).isUnDef()&&(g=l+"doesn't contain "+d);if(f&&0>String(h).indexOf(d))throw g;return m},notContains:(d,g)=>{if(!$$(d).isString())throw"please provide a string to check if not contains";$$(g).isUnDef()&&(g=l+"contains "+d);if(f&&0<=String(h).indexOf(d))throw g;return m},starts:(d,g)=>{if(!$$(d).isString())throw"please provide a string to check if it starts with";
    $$(g).isUnDef()&&(g=l+"doesn't start with '"+d+"'");if(f&&!h.startsWith(aValu))throw g;return m},ends:(d,g)=>{if(!$$(d).isString())throw"please provide a string to check if it ends with";$$(g).isUnDef()&&(g=l+"doesn't end with '"+d+"'");if(f&&!h.endsWith(d))throw g;return m},notStarts:(d,g)=>{if(!$$(d).isString())throw"please provide a string to check if it not starts with";$$(g).isUnDef()&&(g=l+"starts with '"+d+"'");if(f&&h.startsWith(aValu))throw g;return m},notEnds:(d,g)=>{if(!$$(d).isString())throw"please provide a string to check if it not ends with";
    $$(g).isUnDef()&&(g=l+"ends with '"+d+"'");if(f&&h.endsWith(d))throw g;return m},regexp:(d,g)=>{$$(g).isUnDef()&&(g=l+"doesn't match '"+d+"'");if(!(d instanceof RegExp))throw"is not a regular expression ("+d+")";if(f&&!d.test(h))throw g;return m},javaRegexp:(d,g,p)=>{if($$(d).isUnDef()||!$$(d).isString())throw"please provide a regular expression string";$$(p).isUnDef()&&(p=l+"doesn't match '"+d+"'");if(f&&!javaRegExp(h).test(d,g))throw p;return m}};return m};